{"version":3,"sources":["../../../../src/modules/auth/guards/ws-jwt.guard.ts"],"sourcesContent":["import { CanActivate, Injectable, UnauthorizedException } from '@nestjs/common'\nimport { ChatEventEnum } from 'src/utils/chat.enum'\nimport { AuthService } from '../auth.service'\n\n@Injectable()\nexport class WsJwtGuard implements CanActivate {\n\tconstructor(private authService: AuthService) {}\n\tasync canActivate(context) {\n\t\tconst client = context.switchToWs().getClient()\n\t\ttry {\n\t\t\tconst user = await this.authService.verifyAccessToken(\n\t\t\t\tclient.handshake.headers.authorization.split(' ')[1]\n\t\t\t)\n\t\t\tif (user) context.switchToWs().getClient().user = user\n\n\t\t\treturn user as boolean\n\t\t} catch (error) {\n\t\t\tclient.emit(\n\t\t\t\tChatEventEnum.CHAT_LOG,\n\t\t\t\tnew UnauthorizedException(error.message)\n\t\t\t)\n\t\t\treturn false\n\t\t}\n\t}\n}\n"],"names":["WsJwtGuard","canActivate","context","client","switchToWs","getClient","user","authService","verifyAccessToken","handshake","headers","authorization","split","error","emit","ChatEventEnum","CHAT_LOG","UnauthorizedException","message","constructor","Injectable"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAKaA;;;eAAAA;;;wBALkD;0BACjC;6BACF;;;;;;;;;;AAGrB,IAAA,AAAMA,aAAN,MAAMA;IAEZ,MAAMC,YAAYC,OAAO,EAAE;QAC1B,MAAMC,SAASD,QAAQE,UAAU,GAAGC,SAAS;QAC7C,IAAI;YACH,MAAMC,OAAO,MAAM,IAAI,CAACC,WAAW,CAACC,iBAAiB,CACpDL,OAAOM,SAAS,CAACC,OAAO,CAACC,aAAa,CAACC,KAAK,CAAC,IAAI,CAAC,EAAE;YAErD,IAAIN,MAAMJ,QAAQE,UAAU,GAAGC,SAAS,GAAGC,IAAI,GAAGA;YAElD,OAAOA;QACR,EAAE,OAAOO,OAAO;YACfV,OAAOW,IAAI,CACVC,uBAAa,CAACC,QAAQ,EACtB,IAAIC,6BAAqB,CAACJ,MAAMK,OAAO;YAExC,OAAO;QACR;IACD;IAjBAC,YAAY,AAAQZ,WAAwB,CAAE;aAA1BA,cAAAA;IAA2B;AAkBhD;AAnBaP;IADZoB,IAAAA,kBAAU;;;eAEuB,wBAAW,4BAAX,wBAAW;;GADhCpB"}